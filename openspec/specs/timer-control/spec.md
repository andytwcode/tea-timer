# timer-control

## Purpose

定義計時器控制功能的規格，包含開始、重置按鈕和狀態管理。

## Requirements

### Requirement: 提供開始按鈕
系統 SHALL 提供開始按鈕，並根據當前模式、狀態和泡數動態調整按鈕文字。

#### Scenario: 單次模式初始狀態
- **WHEN** 連續沖泡模式未啟用且尚未開始倒數
- **THEN** 開始按鈕顯示「開始」

#### Scenario: 連續模式初始狀態
- **WHEN** 連續沖泡模式啟用且泡數為 1
- **THEN** 開始按鈕顯示「開始第 1 泡」

#### Scenario: 連續模式完成後增量為零
- **WHEN** 連續沖泡模式啟用、增量為 0、且第 3 泡完成
- **THEN** 開始按鈕顯示「重新開始」

#### Scenario: 連續模式完成後增量大於零
- **WHEN** 連續沖泡模式啟用、增量大於 0、且第 2 泡完成
- **THEN** 開始按鈕顯示「開始第 3 泡 (X秒)」，其中 X 為第 3 泡的總秒數

#### Scenario: 倒數進行中按鈕文字
- **WHEN** 第 4 泡倒數正在進行
- **THEN** 開始按鈕顯示「第 4 泡計時中」且為禁用狀態

#### Scenario: 點擊開始下一泡
- **WHEN** 第 5 泡完成後使用者點擊「開始第 6 泡」按鈕
- **THEN** 系統開始第 6 泡的倒數計時

### Requirement: 提供重置按鈕
系統 SHALL 提供「重置」按鈕，在連續沖泡模式下同時重置泡數計數器。

#### Scenario: 倒數進行中點擊重置
- **WHEN** 第 3 泡倒數正在進行且使用者點擊「重置」按鈕
- **THEN** 系統停止倒數
- **AND** 泡數計數器重置為 1
- **AND** 顯示時間恢復為第一泡的初始輸入時間

#### Scenario: 倒數結束後點擊重置
- **WHEN** 第 8 泡倒數已結束且使用者點擊「重置」按鈕
- **THEN** 泡數計數器重置為 1
- **AND** 顯示時間恢復為第一泡的初始輸入時間

#### Scenario: 未開始倒數時點擊重置
- **WHEN** 尚未開始倒數且使用者點擊「重置」按鈕
- **THEN** 泡數計數器保持為 1
- **AND** 顯示時間保持為第一泡的初始輸入時間

### Requirement: 開始按鈕在倒數中禁用
系統 SHALL 在倒數進行期間禁用「開始」按鈕，防止重複啟動。

#### Scenario: 倒數進行中開始按鈕禁用
- **WHEN** 任一泡倒數正在進行
- **THEN** 開始按鈕應為禁用狀態，無法點擊
- **AND** 按鈕文字顯示「第 X 泡計時中」

#### Scenario: 倒數停止或重置後開始按鈕啟用
- **WHEN** 倒數結束或使用者點擊重置
- **THEN** 開始按鈕恢復為可點擊狀態
- **AND** 按鈕文字根據當前狀態更新

### Requirement: 驗證輸入後才啟動倒數
系統 SHALL 在使用者點擊「開始」時先驗證第一泡的輸入時間，僅在有效時才啟動倒數。啟動後若通知權限已授予，系統將在倒數完成時發送系統通知。

#### Scenario: 有效輸入啟動倒數
- **WHEN** 使用者輸入第一泡時間為 3 分鐘 0 秒並點擊「開始」
- **THEN** 系統驗證通過，開始倒數

#### Scenario: 無效輸入不啟動倒數
- **WHEN** 使用者輸入第一泡時間為 0 分鐘 2 秒（總計 2 秒，少於 5 秒）並點擊「開始」
- **THEN** 系統驗證失敗，不啟動倒數，顯示錯誤訊息

#### Scenario: 倒數完成時觸發通知
- **WHEN** 倒數計時達到 0 秒且通知權限已授予
- **THEN** 系統停止倒數並發送系統通知
- **AND** 通知內容依據單泡或連續沖泡模式顯示

#### Scenario: 倒數完成但無通知權限
- **WHEN** 倒數計時達到 0 秒但通知權限未授予或被拒絕
- **THEN** 系統停止倒數，不發送通知，其他功能正常運作

### Requirement: 提供結束沖泡按鈕
系統 SHALL 在連續沖泡模式下，當倒數完成且增量大於 0 時，提供「結束沖泡」次按鈕。

#### Scenario: 完成後顯示結束沖泡按鈕
- **WHEN** 連續沖泡模式啟用、增量大於 0、且第 2 泡完成
- **THEN** 系統顯示「結束沖泡」次按鈕

#### Scenario: 點擊結束沖泡
- **WHEN** 第 5 泡完成後使用者點擊「結束沖泡」按鈕
- **THEN** 系統重置為初始狀態
- **AND** 泡數計數器重置為 1

#### Scenario: 單次模式下不顯示結束沖泡
- **WHEN** 連續沖泡模式未啟用
- **THEN** 系統不顯示「結束沖泡」按鈕

#### Scenario: 增量為零時不顯示結束沖泡
- **WHEN** 連續沖泡模式啟用但增量為 0
- **THEN** 系統不顯示「結束沖泡」按鈕
